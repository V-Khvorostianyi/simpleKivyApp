#:import main main
#:import w wallet_app
#:import sla kivy.adapters.simplelistadapter
#:import hex kivy.utils.get_color_from_hex
<BlueCanvas>:
    canvas.before:
        Color:
            rgba: hex('#36aad0')
        Rectangle:
            size: self.size
            pos: self.pos
<DelCat>:
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Del Category"
        DeleteCatDrop:
            id:del_cat_drop
    BoxLayout:
        Button:
            text: "OK"
            id: del_cat_btn
            on_press:
                main.del_cat(del_cat_drop.btn_name.text)
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))

<DelCatIn>:
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Del Category"
        DeleteCatDropIn:
            id:del_cat_drop
    BoxLayout:
        Button:
            text: "OK"
            id: del_cat_btn
            on_press:
                main.del_cat(del_cat_drop.btn_name.text)
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
<DelAcc>:
    Label:
        text: "Del Account"
    DeleteAccDrop:
        id: del_acc_drop
    BoxLayout:
        Button:
            text: "OK"
            id: del_cat_btn
            on_press:
                acc_name =  del_acc_drop.btn_name.text.split(':')[0]
                main.del_acc(acc_name)
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
<AccountAdd>:
    Label:
        text: "Add Account"
    TextInput:
        id: add_account
    FloatInput:
        id: add_acc_value
    BoxLayout:
        Button:
            text: "OK"
            id: add_acc_btn
            on_press:
                main.add_new_acc(add_account.text, add_acc_value.text)
                if root.parent.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
<CatAdd>:
    Label:
        text: "Add Outcome Category"
    TextInput:
        id: add_category
    BoxLayout:
        Button:
            text: "OK"
            id: add_cat_btn
            on_press:
                main.add_new_cat(add_category.text,True)
                if root.parent.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))

<CatAddIn>:
    Label:
        text: "Add InCome Category"
    TextInput:
        id: add_category
    BoxLayout:
        Button:
            text: "OK"
            id: add_cat_btn
            on_press:
                main.add_new_cat(add_category.text,False)
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))

        Button:
            text: "Cancel"
            on_press:
                if root.parent.parent.name == "add_out_tr":root.parent.parent.parent.switch_to(main.InputWindow(name="add_out_tr"))
                else:root.parent.parent.parent.switch_to(main.AccountScreen(name="add_in_tr"))
<Lb>:
    size: 100, 210

<MainView>:
    ListView:
        adapter:
            sla.SimpleListAdapter(
            data=w.search(w.wallet.transaction_list)[1],
            cls=main.Lb
            )

<TransactionScreen>:
    AnchorLayout:
        padding:
            root.width*.1,10,root.width*.1,root.height * 3/4
        GridLayout:
            rows: 2
            spacing:20
            row_force_default: True
            row_default_height: 40
            GridLayout:
                cols: 2
                Button:
                    text: "Back"
                    on_press:
                        root.parent.switch_to(main.StartScreen(name='main'))
                Button:
                    text:'Delete last transaction'
                    on_press:
                        w.del_tr(1)
                        root.parent.switch_to(main.TransactionScreen(name='out_tr_screen'))

    AnchorLayout:
        padding: root.width*.1,root.height * 1/4,root.width*.1,10
        MainView

<StartScreen>:
    AnchorLayout:
        padding:
            root.width*.1,10,root.width*.1,root.height * 2/4
        HeadTitle:
    AnchorLayout:
        padding: root.width*.1,root.height * 3/4,root.width*.1,10
        GridLayout:
            cols: 2
            Button:
                text: "add new income \ntransaction"
                on_press:
                    root.parent.switch_to(main.AccountScreen(name='add_in_tr'))

            Button:
                text: "add new outcome \ntransaction"
                on_press:
                    root.parent.switch_to(main.InputWindow(name="add_out_tr"))

            Button:
                text: "view all income \ntransactions"
                on_press:
                    root.parent.switch_to(main.CategoryScreen(name='in_tr_screen'))

            Button:
                text: "view all outcome \ntransactions"
                on_press:
                    root.parent.switch_to(main.TransactionScreen(name='out_tr_screen'))

<HeadTitle>:
    GridLayout:
        rows: 3
        spacing: 20
        BoxLayout:
            orientation: 'vertical'
            Label:
                text: 'MyWallet\n'
            Label:
                text:"Balance: {}\n".format(w.search(w.wallet.transaction_list)[4])
        BoxLayout:
            Label:
                text: "\nLast income:\n{}".format(w.last_transaction_view(False))
            Label:
                text: "\nLast outcome:\n{}".format(w.last_transaction_view(True))
        BoxLayout:
            Label:
                text: 'Accounts:\n{}'.format(w.list_view(w.wallet.account_list))

<InputWindow>:
    AnchorLayout:
        padding: 50,0,50, root.height*.1


        GridLayout:
            cols: 1
            row_force_default: True
            row_default_height: 48
            spacing: 60


            Label:
                text: "Enter value"
            FloatInput:
                id: val
            BoxLayout:
                AccDrop:
                    id: acc_drop
                CatDrop:
                    id: cat_drop
            Button:
                text: "Add transaction"
                on_press:
                    acc_name =  acc_drop.btn_name.text.split(':')[0]
                    main.add_new_tr(acc_name,cat_drop.btn_name.text,val.text)
                    root.parent.switch_to(main.StartScreen(name='main'))
            Button:
                text: "Cancel"
                on_press:
                    root.parent.switch_to(main.StartScreen(name='main'))
<AccountScreen>:
    AnchorLayout:
        padding: 50,0,50, root.height*.1


        GridLayout:
            cols: 1
            row_force_default: True
            row_default_height: 48
            spacing: 60


            Label:
                text: "Enter value"
            FloatInput:
                id: val
            BoxLayout:
                AccDrop:
                    id: acc_drop_in
                InCat:
                    id: cat_drop_in
            Button:
                text: "Add transaction"
                on_press:
                    acc_name =  acc_drop_in.btn_name.text.split(':')[0]
                    main.add_new_tr(acc_name,cat_drop_in.btn_name.text,val.text)
                    root.parent.switch_to(main.StartScreen(name='main'))
            Button:
                text: "Cancel"
                on_press:
                    root.parent.switch_to(main.StartScreen(name='main'))

<MainViewIncome>:
    ListView:
        adapter:
            sla.SimpleListAdapter(
            data=w.search(w.wallet.transaction_list)[3],
            cls=main.Lb
            )

<CategoryScreen>:
    AnchorLayout:
        padding:
            root.width*.1,10,root.width*.1,root.height * 3/4
        GridLayout:
            rows: 2
            spacing:20
            row_force_default: True
            row_default_height: 40
            GridLayout:
                cols: 2
                Button:
                    text: "Back"
                    on_press:
                        root.parent.switch_to(main.StartScreen(name='main'))
                Button:
                    text:'Delete last transaction'
                    on_press:
                        w.del_tr(3)
                        root.parent.switch_to(main.CategoryScreen(name='in_tr_screen'))
    AnchorLayout:
        padding: root.width*.1,root.height * 1/4,root.width*.1,10
        MainViewIncome












